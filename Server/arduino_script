#include <SoftwareSerial.h>

long pressureConst=2000;
long pressureVal[10];
int i;
int flag[10];
int t=-1;
int valTaken;
int final=0;
int numValue=0;
int N=10;
int isSleeping=0;

void setup() {
  Serial.begin(9600);
}

void loop() {
  /*prendo valore da sensore di pressione */
  delay(500);
  t=(t+1)%50;
  valTaken=pressureConst*sin(0.02*t);
  numValue=numValue+1;
  //Serial.print("Valore acquisito:");
  //Serial.println(valTaken);
  for(i=1;i<N;i++){
    pressureVal[i-1]=pressureVal[i];
  }
  pressureVal[N-1]=valTaken;
  for(i=0;i<N&& numValue>N-1 ;i++){
    /*Serial.print("Percentuale");
    Serial.println(pressureVal[i]*100/pressureConst);*/
    if((pressureVal[i]*100)/pressureConst<70){
      //Serial.println("il valore é preoccupante");
      flag[i]=1;
    }
  }
  for(i=0;i<N;i++){
    if(flag[i]==1){
      final=final+1;
    }
  }
  /*Serial.println("Il numero di flag attivi é ");
  Serial.println(final);*/
  if(final==N&&numValue>N-1){
    if(isSleeping==0){
    isSleeping=1;
    Serial.println(valTaken);
    //comunicazione raspberry
    }
    //mando valore a raspberry
   // Serial.write(valTaken);
  } else {
       if(isSleeping==1){
        isSleeping=0;
        Serial.println(valTaken);
        //comunicazione raspberry
    }
  }
  final=0;
  for(i=0;i<N;i++){
    flag[i]=0;
  }
}